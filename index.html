<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI News / Automation / Notion</title>
  <style>
    :root{
      --muted:#92a0b3; --text:#e8eef7; --line:#1b2a43;
      --accent:#6ee7ff; --accent2:#a78bfa;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo", "Noto Sans KR", Arial, "Helvetica Neue", Helvetica, sans-serif;
    }
    html,body{height:100%; background:transparent; margin:0;}
    body{font-family:var(--sans); color:var(--text);}
    .wrap{
      background:linear-gradient(180deg, rgba(16,24,39,.92), rgba(11,15,25,.92));
      border:1px solid var(--line);
      box-shadow:var(--shadow);
      border-radius:var(--radius);
      overflow:hidden;
      max-width:980px;
      margin:0 auto;
      min-height:560px;
    }
    header{display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid var(--line); gap:12px;}
    .brand{display:flex; align-items:center; gap:10px; min-width:0;}
    .dot{width:10px; height:10px; border-radius:999px; background: radial-gradient(circle at 30% 30%, var(--accent), var(--accent2)); box-shadow:0 0 16px rgba(110,231,255,.35);}
    .title{font-weight:900; letter-spacing:-0.2px; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .subtitle{color:var(--muted); font-size:12px; margin-left:8px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .controls{display:flex; align-items:center; gap:8px;}
    .btn{appearance:none; border:1px solid var(--line); background:rgba(255,255,255,.03); color:var(--text); padding:8px 10px; border-radius:12px; cursor:pointer; font-size:12px;}
    .btn:hover{border-color:rgba(110,231,255,.45);}
    .pill{font-family:var(--mono); font-size:11px; color:var(--muted); padding:6px 10px; border:1px solid var(--line); border-radius:999px; background:rgba(255,255,255,.02); max-width:340px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .tabs,.subtabs{display:flex; gap:8px; padding:10px 12px; border-bottom:1px solid var(--line); flex-wrap:wrap;}
    .tabs{background:rgba(255,255,255,.02);}
    .subtabs{background:rgba(255,255,255,.015);}
    .tab,.subtab{border:1px solid var(--line); background:rgba(255,255,255,.02); padding:8px 10px; border-radius:999px; cursor:pointer; color:var(--muted); user-select:none;}
    .subtab{padding:7px 10px; font-size:11px;}
    .tab{font-size:12px;}
    .tab.active{color:var(--text); border-color:rgba(110,231,255,.55); box-shadow:0 0 0 3px rgba(110,231,255,.12) inset;}
    .subtab.active{color:var(--text); border-color:rgba(167,139,250,.6); box-shadow:0 0 0 3px rgba(167,139,250,.12) inset;}
    .bar{display:flex; gap:10px; align-items:center; padding:10px 12px; border-bottom:1px solid var(--line); flex-wrap:wrap;}
    .search{flex:1 1 220px; display:flex; align-items:center; border:1px solid var(--line); background:rgba(255,255,255,.02); border-radius:12px; padding:8px 10px; gap:8px;}
    .search input{width:100%; border:0; outline:0; background:transparent; color:var(--text); font-size:12px;}
    .meta{display:flex; gap:8px; align-items:center; color:var(--muted); font-size:12px;}
    .chip{border:1px solid var(--line); background:rgba(255,255,255,.02); border-radius:999px; padding:6px 10px; font-size:11px; color:var(--muted); cursor:pointer; user-select:none;}
    .chip.on{color:var(--text); border-color:rgba(167,139,250,.6); box-shadow:0 0 0 3px rgba(167,139,250,.12) inset;}
    main{padding:12px;}
    .grid{display:grid; grid-template-columns: 1fr; gap:10px;}
    .card{border:1px solid var(--line); border-radius:14px; background:rgba(255,255,255,.02); padding:12px 12px 10px;}
    .row{display:flex; align-items:flex-start; justify-content:space-between; gap:10px;}
    .h{font-size:13px; font-weight:900; letter-spacing:-.2px; margin:0; line-height:1.35;}
    .badges{display:flex; gap:6px; flex-wrap:wrap; justify-content:flex-end;}
    .badge{font-size:10px; border-radius:999px; padding:4px 8px; border:1px solid var(--line); color:var(--muted); background:rgba(255,255,255,.02); white-space:nowrap;}
    .b1{border-color:rgba(110,231,255,.35); color:rgba(110,231,255,.95);}
    .b2{border-color:rgba(167,139,250,.35); color:rgba(167,139,250,.95);}
    .b3{border-color:rgba(52,211,153,.35); color:rgba(52,211,153,.95);}
    .b4{border-color:rgba(251,191,36,.35); color:rgba(251,191,36,.95);}
    .sum{color:rgba(232,238,247,.92); font-size:12px; margin:8px 0 10px; line-height:1.55; white-space:pre-wrap;}
    .foot{display:flex; align-items:center; justify-content:space-between; gap:10px; border-top:1px solid rgba(27,42,67,.7); padding-top:10px; color:var(--muted); font-size:11px; flex-wrap:wrap;}
    a{color:var(--accent); text-decoration:none;}
    a:hover{text-decoration:underline;}
    .small{font-family:var(--mono); opacity:.95;}
    .empty{padding:24px 12px; color:var(--muted); font-size:12px; text-align:center; border:1px dashed rgba(27,42,67,.9); border-radius:14px; background:rgba(255,255,255,.01);}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="dot"></div>
        <div class="title">AI News / Automation / Notion</div>
        <div class="subtitle" id="subTitle">ÌïµÏã¨ Ïù¥ÏäàÎßå ÏûêÎèô ÏöîÏïΩ</div>
      </div>
      <div class="controls">
        <div class="pill" id="statusPill">Î°úÎî© Ï§ÄÎπÑ</div>
        <button class="btn" id="refreshBtn">ÏÉàÎ°úÍ≥†Ïπ®</button>
      </div>
    </header>

    <div class="tabs" id="mainTabs">
      <div class="tab active" data-tab="ai">AI</div>
      <div class="tab" data-tab="automation">Automation</div>
      <div class="tab" data-tab="notion">Notion</div>
    </div>

    <div class="subtabs" id="subTabs"></div>

    <div class="bar">
      <div class="search">
        <span style="opacity:.7">üîé</span>
        <input id="q" placeholder="Í≤ÄÏÉâ: GPT, Claude, Gemini, NotebookLM, n8n, Make, Zapier, Opal..." />
      </div>
      <div class="meta">
        <div class="chip on" id="onlyFresh">ÏµúÍ∑º 24h</div>
        <div class="chip" id="onlyTop">ÏÉÅÏúÑÎßå</div>
      </div>
    </div>

    <main>
      <div class="grid" id="list"></div>
      <div class="empty" id="empty" style="display:none">ÌëúÏãúÌï† Îâ¥Ïä§Í∞Ä ÏóÜÏäµÎãàÎã§.</div>
    </main>
  </div>

<script>
const DATA_PATHS = {
  ai: "./data/ai.json",
  automation: "./data/automation.json",
  notion: "./data/notion.json"
};

const SUBTABS = {
  ai: [
    { id:"all", label:"All" },
    { id:"llm", label:"LLM" },
    { id:"agents", label:"Agents" },
    { id:"rag", label:"RAG/Vector" },
    { id:"eval", label:"Eval/Observability" },
    { id:"multimodal", label:"Multimodal" },
    { id:"prod", label:"Productivity (NotebookLM)" },
    { id:"hot", label:"Hot/Policy/Security" }
  ],
  automation: [
    { id:"all", label:"All" },
    { id:"make", label:"Make" },
    { id:"n8n", label:"n8n" },
    { id:"zapier", label:"Zapier" },
    { id:"opal", label:"Google Opal" },
    { id:"workflow", label:"Workflows" },
    { id:"hot", label:"Hot/Security" }
  ],
  notion: [
    { id:"all", label:"All" },
    { id:"update", label:"Updates" },
    { id:"status", label:"Status/Incident" },
    { id:"creators", label:"Creators" },
    { id:"hot", label:"Hot" }
  ]
};

const RULES = [
  { bucket:"llm", tag:"GPT/OpenAI", w:40, k:["gpt","openai","chatgpt","assistants api","responses api","gpt-4","gpt-5","oai"] },
  { bucket:"llm", tag:"Claude/Anthropic", w:40, k:["claude","anthropic"] },
  { bucket:"llm", tag:"Gemini/Google", w:35, k:["gemini","google ai","deepmind","vertex ai"] },

  { bucket:"agents", tag:"Agents", w:24, k:["agent","agentic","tool use","function calling","mcp","model context protocol","langgraph","autogen","crewai"] },
  { bucket:"workflow", tag:"Workflows", w:18, k:["workflow","orchestration","pipeline","dag","scheduler"] },

  { bucket:"rag", tag:"RAG/Vector", w:20, k:["rag","retrieval","vector","embedding","semantic search","rerank","pinecone","weaviate","milvus","qdrant"] },

  { bucket:"eval", tag:"Eval/Observability", w:18, k:["eval","evaluation","observability","tracing","langfuse","helicone","ragas","wandb","weights & bias"] },

  { bucket:"multimodal", tag:"Multimodal", w:16, k:["multimodal","vision","image generation","video generation","runway","pika","midjourney","sora"] },

  { bucket:"prod", tag:"NotebookLM", w:22, k:["notebooklm","notebook lm","notebooklm plus","workspace updates","sources","studio"] },

  { bucket:"make", tag:"Make", w:24, k:["make.com","integromat","scenario","iterator","make module"] },
  { bucket:"n8n", tag:"n8n", w:24, k:["n8n","n8n node","n8n workflow","n8n cloud"] },
  { bucket:"zapier", tag:"Zapier", w:20, k:["zapier","zap","zaps","zapier ai"] },
  { bucket:"opal", tag:"Google Opal", w:20, k:["google opal","opal ai","opal no-code","opal"] },
  { bucket:"automation", tag:"Automation", w:16, k:["automation","rpa","integration","webhook","iPaaS","no-code","low-code"] },

  { bucket:"update", tag:"Notion Update", w:22, k:["notion update","release notes","what's new","database view","formula"] },
  { bucket:"status", tag:"Notion Status", w:20, k:["notion status","incident","outage","downtime","degraded"] },
  { bucket:"creators", tag:"Creators", w:18, k:["template","creator","marketplace","notion creators","ambassador"] },

  { bucket:"hot", tag:"Hot", w:20, k:["security","vulnerability","cve","rce","breach","leak","policy","pricing","rate limit","outage","incident","lawsuit"] },
  { bucket:"hot", tag:"Release", w:10, k:["release","launch","update","beta","preview","ga"] },
];

const STATE = { tab:"ai", sub:"all", q:"", onlyFresh:true, onlyTop:false, raw:[], filtered:[] };

const els = {
  mainTabs: [...document.querySelectorAll("#mainTabs .tab")],
  subTabs: document.getElementById("subTabs"),
  list: document.getElementById("list"),
  empty: document.getElementById("empty"),
  pill: document.getElementById("statusPill"),
  subTitle: document.getElementById("subTitle"),
  refreshBtn: document.getElementById("refreshBtn"),
  q: document.getElementById("q"),
  onlyFresh: document.getElementById("onlyFresh"),
  onlyTop: document.getElementById("onlyTop"),
};

function fmtKST(iso) {
  try{
    const d = new Date(iso);
    return d.toLocaleString("ko-KR", { timeZone: "Asia/Seoul", hour12: false });
  }catch(e){ return iso || ""; }
}
function hoursAgo(iso){
  const t = new Date(iso).getTime();
  return (Date.now() - t) / (1000*60*60);
}
function escapeHtml(str){
  return (str||"").replace(/[&<>"']/g, m => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]));
}
function escapeAttr(str){ return (str||"").replace(/"/g, "&quot;"); }

function scoreAndClassify(item){
  const text = ((item.title||"") + " " + (item.summary_ko||"") + " " + (item.source||"")).toLowerCase();
  let score = 0;
  let tags = new Set(item.tags || []);
  let buckets = new Set(item.buckets || []);

  for (const r of RULES){
    const hit = r.k.some(x => text.includes(String(x).toLowerCase()));
    if (hit){
      score += r.w;
      tags.add(r.tag);
      buckets.add(r.bucket);
    }
  }

  const h = item.published_at ? hoursAgo(item.published_at) : 999;
  if (h <= 24) score += 25;
  else if (h <= 72) score += 12;

  return { ...item, score: typeof item.score==="number"?item.score:score, tags:[...tags], buckets:[...buckets] };
}

function normalize(items){
  return (items||[])
    .map(it => ({
      title: it.title || "",
      url: it.url || it.link || "",
      source: it.source || it.site || "Unknown",
      published_at: it.published_at || it.pubDate || it.published || "",
      summary_ko: it.summary_ko || it.summary || it.description_ko || "",
      tags: Array.isArray(it.tags) ? it.tags : [],
      buckets: Array.isArray(it.buckets) ? it.buckets : [],
      score: typeof it.score === "number" ? it.score : undefined
    }))
    .map(scoreAndClassify)
    .sort((a,b) => (b.score||0) - (a.score||0));
}

function badgeClass(tag){
  const t = (tag||"").toLowerCase();
  if (t.includes("gpt") || t.includes("claude") || t.includes("gemini") || t.includes("llm")) return "badge b1";
  if (t.includes("make") || t.includes("n8n") || t.includes("zapier") || t.includes("opal") || t.includes("automation") || t.includes("workflow")) return "badge b2";
  if (t.includes("hot") || t.includes("security") || t.includes("policy") || t.includes("pricing") || t.includes("release")) return "badge b3";
  if (t.includes("notion") || t.includes("notebooklm") || t.includes("creators") || t.includes("status")) return "badge b4";
  return "badge";
}

function buildSubTabs(){
  els.subTabs.innerHTML = "";
  const list = SUBTABS[STATE.tab] || [{id:"all",label:"All"}];
  for (const t of list){
    const el = document.createElement("div");
    el.className = "subtab" + (t.id === STATE.sub ? " active" : "");
    el.textContent = t.label;
    el.addEventListener("click", () => { STATE.sub = t.id; buildSubTabs(); render(); });
    els.subTabs.appendChild(el);
  }
}

function applyFilters(){
  const q = STATE.q.trim().toLowerCase();
  let items = [...STATE.raw];

  if (STATE.onlyFresh){
    items = items.filter(x => x.published_at && hoursAgo(x.published_at) <= 24);
  }
  if (STATE.onlyTop){
    items = items.slice(0, 12);
  }
  if (STATE.sub !== "all"){
    items = items.filter(x => (x.buckets||[]).includes(STATE.sub));
  }
  if (q){
    items = items.filter(x => (x.title+" "+x.summary_ko+" "+x.source+" "+(x.tags||[]).join(" ")).toLowerCase().includes(q));
  }

  STATE.filtered = items;
}

function render(){
  applyFilters();
  els.list.innerHTML = "";
  els.empty.style.display = STATE.filtered.length ? "none" : "block";

  for (const it of STATE.filtered){
    const card = document.createElement("div");
    card.className = "card";
    const tags = (it.tags||[]).slice(0, 7).map(t => `<span class="${badgeClass(t)}">${escapeHtml(t)}</span>`).join("");

    card.innerHTML = `
      <div class="row">
        <h3 class="h">${escapeHtml(it.title)}</h3>
        <div class="badges">${tags}</div>
      </div>
      <div class="sum">${escapeHtml(it.summary_ko || "ÏöîÏïΩÏù¥ ÏóÜÏäµÎãàÎã§.")}</div>
      <div class="foot">
        <div>
          <span class="small">Ï∂úÏ≤ò:</span> ${escapeHtml(it.source)}
          <span style="margin:0 8px; opacity:.5">|</span>
          <span class="small">ÏãúÍ∞Ñ(KST):</span> ${escapeHtml(fmtKST(it.published_at))}
        </div>
        <div><a href="${escapeAttr(it.url)}" target="_blank" rel="noopener">Ï†ÑÎ¨∏ Î≥¥Í∏∞ ‚Üó</a></div>
      </div>
    `;
    els.list.appendChild(card);
  }
}

function subtitleByTab(){
  if (STATE.tab === "ai") return "LLM/ÏóêÏù¥Ï†ÑÌä∏/RAG/Î©ÄÌã∞Î™®Îã¨/NotebookLM Ï§ëÏã¨";
  if (STATE.tab === "automation") return "Make/n8n/Zapier/Google Opal + ÏõåÌÅ¨ÌîåÎ°úÏö∞";
  return "Notion ÏóÖÎç∞Ïù¥Ìä∏/Ïû•Ïï†/ÌÅ¨Î¶¨ÏóêÏù¥ÌÑ∞";
}

async function fetchNews(){
  const path = DATA_PATHS[STATE.tab];
  els.pill.textContent = "Í∞ÄÏ†∏Ïò§Îäî Ï§ë‚Ä¶";
  try{
    const res = await fetch(path, { cache: "no-store" });
    if (!res.ok) throw new Error("JSON Î°úÎìú Ïò§Î•ò: " + res.status);
    const data = await res.json();
    STATE.raw = normalize(data.items);
    els.pill.textContent = "ÏóÖÎç∞Ïù¥Ìä∏: " + (data.updated_at ? fmtKST(data.updated_at) : fmtKST(new Date().toISOString()));
    els.subTitle.textContent = subtitleByTab();
    buildSubTabs();
    render();
  }catch(err){
    console.error(err);
    els.pill.textContent = "Î°úÎìú Ïã§Ìå®";
    els.subTitle.textContent = "data/*.json ÏÉùÏÑ± Ïó¨Î∂Ä ÌôïÏù∏";
    STATE.raw = [];
    buildSubTabs();
    render();
  }
}

els.mainTabs.forEach(t => t.addEventListener("click", () => {
  els.mainTabs.forEach(x => x.classList.remove("active"));
  t.classList.add("active");
  STATE.tab = t.dataset.tab;
  STATE.sub = "all";
  fetchNews();
}));

els.refreshBtn.addEventListener("click", fetchNews);
els.q.addEventListener("input", (e) => { STATE.q = e.target.value || ""; render(); });
els.onlyFresh.addEventListener("click", () => { STATE.onlyFresh = !STATE.onlyFresh; els.onlyFresh.classList.toggle("on", STATE.onlyFresh); fetchNews(); });
els.onlyTop.addEventListener("click", () => { STATE.onlyTop = !STATE.onlyTop; els.onlyTop.classList.toggle("on", STATE.onlyTop); fetchNews(); });

buildSubTabs();
fetchNews();
setInterval(fetchNews, 10 * 60 * 1000);
</script>
</body>
</html>
